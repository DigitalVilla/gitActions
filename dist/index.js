module.exports=(()=>{var e={673:function(e,t,n){"use strict";var s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)if(Object.hasOwnProperty.call(e,n))t[n]=e[n];t["default"]=e;return t};Object.defineProperty(t,"__esModule",{value:true});const r=s(n(87));const o=n(69);function issueCommand(e,t,n){const s=new Command(e,t,n);process.stdout.write(s.toString()+r.EOL)}t.issueCommand=issueCommand;function issue(e,t=""){issueCommand(e,{},t)}t.issue=issue;const i="::";class Command{constructor(e,t,n){if(!e){e="missing.command"}this.command=e;this.properties=t;this.message=n}toString(){let e=i+this.command;if(this.properties&&Object.keys(this.properties).length>0){e+=" ";let t=true;for(const n in this.properties){if(this.properties.hasOwnProperty(n)){const s=this.properties[n];if(s){if(t){t=false}else{e+=","}e+=`${n}=${escapeProperty(s)}`}}}}e+=`${i}${escapeData(this.message)}`;return e}}function escapeData(e){return o.toCommandValue(e).replace(/%/g,"%25").replace(/\r/g,"%0D").replace(/\n/g,"%0A")}function escapeProperty(e){return o.toCommandValue(e).replace(/%/g,"%25").replace(/\r/g,"%0D").replace(/\n/g,"%0A").replace(/:/g,"%3A").replace(/,/g,"%2C")}},631:function(e,t,n){"use strict";var s=this&&this.__awaiter||function(e,t,n,s){function adopt(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,r){function fulfilled(e){try{step(s.next(e))}catch(e){r(e)}}function rejected(e){try{step(s["throw"](e))}catch(e){r(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((s=s.apply(e,t||[])).next())})};var r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)if(Object.hasOwnProperty.call(e,n))t[n]=e[n];t["default"]=e;return t};Object.defineProperty(t,"__esModule",{value:true});const o=n(673);const i=n(284);const u=n(69);const c=r(n(87));const a=r(n(622));var p;(function(e){e[e["Success"]=0]="Success";e[e["Failure"]=1]="Failure"})(p=t.ExitCode||(t.ExitCode={}));function exportVariable(e,t){const n=u.toCommandValue(t);process.env[e]=n;const s=process.env["GITHUB_ENV"]||"";if(s){const t="_GitHubActionsFileCommandDelimeter_";const s=`${e}<<${t}${c.EOL}${n}${c.EOL}${t}`;i.issueCommand("ENV",s)}else{o.issueCommand("set-env",{name:e},n)}}t.exportVariable=exportVariable;function setSecret(e){o.issueCommand("add-mask",{},e)}t.setSecret=setSecret;function addPath(e){const t=process.env["GITHUB_PATH"]||"";if(t){i.issueCommand("PATH",e)}else{o.issueCommand("add-path",{},e)}process.env["PATH"]=`${e}${a.delimiter}${process.env["PATH"]}`}t.addPath=addPath;function getInput(e,t){const n=process.env[`INPUT_${e.replace(/ /g,"_").toUpperCase()}`]||"";if(t&&t.required&&!n){throw new Error(`Input required and not supplied: ${e}`)}return n.trim()}t.getInput=getInput;function setOutput(e,t){o.issueCommand("set-output",{name:e},t)}t.setOutput=setOutput;function setCommandEcho(e){o.issue("echo",e?"on":"off")}t.setCommandEcho=setCommandEcho;function setFailed(e){process.exitCode=p.Failure;error(e)}t.setFailed=setFailed;function isDebug(){return process.env["RUNNER_DEBUG"]==="1"}t.isDebug=isDebug;function debug(e){o.issueCommand("debug",{},e)}t.debug=debug;function error(e){o.issue("error",e instanceof Error?e.toString():e)}t.error=error;function warning(e){o.issue("warning",e instanceof Error?e.toString():e)}t.warning=warning;function info(e){process.stdout.write(e+c.EOL)}t.info=info;function startGroup(e){o.issue("group",e)}t.startGroup=startGroup;function endGroup(){o.issue("endgroup")}t.endGroup=endGroup;function group(e,t){return s(this,void 0,void 0,function*(){startGroup(e);let n;try{n=yield t()}finally{endGroup()}return n})}t.group=group;function saveState(e,t){o.issueCommand("save-state",{name:e},t)}t.saveState=saveState;function getState(e){return process.env[`STATE_${e}`]||""}t.getState=getState},284:function(e,t,n){"use strict";var s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)if(Object.hasOwnProperty.call(e,n))t[n]=e[n];t["default"]=e;return t};Object.defineProperty(t,"__esModule",{value:true});const r=s(n(747));const o=s(n(87));const i=n(69);function issueCommand(e,t){const n=process.env[`GITHUB_${e}`];if(!n){throw new Error(`Unable to find environment variable for file command ${e}`)}if(!r.existsSync(n)){throw new Error(`Missing file at path: ${n}`)}r.appendFileSync(n,`${i.toCommandValue(t)}${o.EOL}`,{encoding:"utf8"})}t.issueCommand=issueCommand},69:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});function toCommandValue(e){if(e===null||e===undefined){return""}else if(typeof e==="string"||e instanceof String){return e}return JSON.stringify(e)}t.toCommandValue=toCommandValue},360:(e,t,n)=>{const{replaceAsync:s,execAsync:r}=n(205);const o=n(631);async function main(){try{const e=o.getInput("app");let t=await r(`yarn add scripty -D && npm i -g serverless`);console.log(sls.stdout);t=await r(`serverless config credentials --provider aws --key ${process.env.AWS_ACCESS_KEY_ID} --secret ${process.env.AWS_SECRET_ACCESS_KEY}`);console.log(sls.stdout);const n=process.env.GITHUB_REF.indexOf("master")>0?"prod":"dev";process.env.NODE_ENV=n;console.log(process.env);if(e.length){console.log(`Deploying app=${e} env=${n}`);t=await r(`yarn sls:test ${e} --stage ${n}`)}o.setOutput("update",t.stdout);o.setOutput("env",process.env)}catch(e){o.setFailed(e.message)}}main()},205:(e,t,n)=>{const s=n(747);const{exec:r}=n(129);const o=n(58);const i=o.createInterface({input:process.stdin,output:process.stdout});function readAsync(e){return new Promise((t,n)=>{i.question(e,e=>{t(e)})})}function closeReadAsync(){return i.close()}function execAsync(e){return new Promise((t,n)=>{r(e,(e,s,r)=>{if(e)return n(e);return t({stderr:r,stdout:s})})})}function replaceAsync(e,t){return new Promise((n,r)=>{s.readFile(e,"utf8",function(o,i){if(o)return r(o);for(const e in t){i=i.replace(new RegExp(e,"g"),t[e])}s.writeFile(e,i,"utf8",function(e){if(e)return r(e);return n(null)})})})}async function lastCommit(e=false){let{stderr:t,stdout:n}=await execAsync("git log --name-status HEAD^..HEAD");if(t)throw new Error(t);const s={};let r=n.split("\n").map((e,t)=>e.split("\t"));s.hash=r[0][0].substring(0,40);s.message=r[0][0].substring(41);r=r.filter(e=>e.length===2);for(let e=0;e<r.length;e++){const t=r[e][1].indexOf("/");const n=r[e][1].substring(0,t)||"root";const o=r[e][1].indexOf("/",t+1);const i=r[e][1].substring(t+1,o)||".";const u=r[e][1].substring(o+1);if(!s[n])s[n]={};if(!s[n][i])s[n][i]=[];s[n][i].push([r[e][0],u])}if(e){for(const e in s){console.log(e+":",s[e])}}return s}e.exports={execAsync:execAsync,readAsync:readAsync,lastCommit:lastCommit,replaceAsync:replaceAsync,closeReadAsync:closeReadAsync}},129:e=>{"use strict";e.exports=require("child_process")},747:e=>{"use strict";e.exports=require("fs")},87:e=>{"use strict";e.exports=require("os")},622:e=>{"use strict";e.exports=require("path")},58:e=>{"use strict";e.exports=require("readline")}};var t={};function __webpack_require__(n){if(t[n]){return t[n].exports}var s=t[n]={exports:{}};var r=true;try{e[n].call(s.exports,s,s.exports,__webpack_require__);r=false}finally{if(r)delete t[n]}return s.exports}__webpack_require__.ab=__dirname+"/";return __webpack_require__(360)})();